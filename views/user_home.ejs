<!DOCTYPE html>

<html>

<head>
<title>Covid-Mole</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8"> 
<link rel="stylesheet" href="/user_style.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin="" />
</head>

<body>


<div id = "map"></div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script> 


<script>
var map = L.map('map').setView([38.2462420, 21.7350847], 16);

var OSM = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright%22%3EOpenStreetMap</a> contributors'
});

OSM.addTo(map);

var blueIcon = L.icon({
    iconUrl: '/icons/supermarket.png',

    iconSize:     [26, 30], // size of the icon
    iconAnchor:   [13, 30], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -20] // point from which the popup should open relative to the iconAnchor
});

var redIcon = L.icon({
    iconUrl: '/icons/supermarketred.png',

    iconSize:     [26, 30], // size of the icon
    iconAnchor:   [13, 30], // point of the icon which will correspond to marker's location
    popupAnchor:  [0, -20] // point from which the popup should open relative to the iconAnchor
});


var gjNoOfferSups = <%- JSON.stringify(gjNoOfferSups) %>;

var gjOfferSups = <%- JSON.stringify(gjOfferSups) %>;


function customPopup(feature){
    let offertext = ``
    for (offer of feature.properties.offers) {
        let temptext = `<div> Προϊόν: ${offer.product} </div>
                        <div> Τιμούλα: ${offer.price} </div>
                        <div> Ημερομηνία Καταχώρησης: ${offer.date} </div>
                        <div> Likers: ${offer.likes} </div>
                        <div> Dislikes: ${offer.dislikes} </div>
                        <div> Διαθέσιμο: ${offer.available} </div>`
        offertext = offertext.concat(temptext)

    }

    return `<b> ${feature.properties.name} </b>
            ${offertext}
                <div> <form action="/add_offer/${feature.properties.id}" method="get">
                <button id='addoffer${feature.properties.name}'>Προσθήκη προσφοράς</button>
                </form></div>

                <div> <form action="/review_offer/${feature.properties.id}" method="get">
                <button id='review${feature.properties.name}'>Αξιολόγηση προσφορών</button>
                </form></div>
    
    `
}

const noOffMarkers = L.geoJSON(gjNoOfferSups, {
    onEachFeature: function(feature, layer){
        layer.setIcon(redIcon);
        layer.bindPopup(customPopup(feature));
    }
}).addTo(map);

const OffMarkers = L.geoJSON(gjOfferSups, {
    onEachFeature: function(feature, layer){
        layer.setIcon(blueIcon);
        layer.bindPopup(customPopup(feature));
    }
}).addTo(map);

var overlays = {

    "Supermarkets without offers":noOffMarkers,

}




L.control.layers(null,overlays).addTo(map);

</script>


<li> 
    <form action="/logout?_method=DELETE" method="POST">
        <button type="submit">Log Out</button>
    </form>
</li>


<a href="/user_profile">
     My Profile
</a>


</body>
</html>